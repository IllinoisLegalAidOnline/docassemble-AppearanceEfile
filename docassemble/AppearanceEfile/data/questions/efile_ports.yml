---
include: 
  - docassemble.EFSPIntegration:codes_helper.yml
---
generic object: ALDocumentBundle
code: |
  x.optional_services.there_are_any = False
---
code: |
  illinois_appearance_bundle.filing_description = f'Appearance application for {users[0].name}'
  illinois_appearance_bundle.reference_number = None
  illinois_appearance_bundle.filing_parties = ['users[0]']
  illinois_appearance_bundle.filing_action = 'efile'
---
code: |
  illinois_appearance_attachment.filing_component_default = '332'
  illinois_appearance_attachment.filing_component_filters = ['Lead Document']
  illinois_appearance_additional.filing_component_default = '331'
  illinois_appearance_additional.filing_component_filters = ['Attachment']
  illinois_appearance_additional_2.filing_component_default = '331'
  illinois_appearance_additional_2.filing_component_filters = ['Attachment']
  illinois_appearance_additional_3.filing_component_default = '331'
  illinois_appearance_additional_3.filing_component_filters = ['Attachment']
  illinois_appearance_additional_blank.filing_component_default = '331'
  illinois_appearance_additional_blank.filing_component_filters = ['Attachment']
---
code: |
  filter_list = []
  if is_trial_by_jury:
    filter_list.append(['Appearance', 'Jury'])
  filter_list.extend([
           CodeType('142566'),
           'Appearance (No Fee: fee exempted by rule/statute)',
           ['Appearance', 'No Fee'],
           'Appearance'])
  illinois_appearance_bundle.filing_type_filters = filter_list
  illinois_appearance_bundle.filing_type_default = '142566'
---
############# Overide some wording #########
generic object: DAObject
id: eserve
question: |
  Would you like to e-file this document, or serve to the desginated party?
fields:
  - Efile or serve?: x.filing_action
    choices:
      - Efile: efile
      - Efile and Serve: efile_and_serve
      - Serve: serve
---
id: document type
generic object: DAObject
question: |
  Was this case ordered to be sealed by the judge?
subquestion: |
  In some cases, the filings and orders are sealed by the court. This means the records are not visible to the public.
  If this happened in your case, you will have to upload a copy of the court order sealing the case.
fields:
  - Was case ordered to be sealed?: x.document_type
    input type: radio
    code: |
      list(reversed(yes_no_confidential(x.document_type_options)))
    default: ${ matching_tuple_option('non-confidential', x.document_type_options) }
---
id: ready to efile
question: |
  Final review before e-filing
subquestion: |
  
  % if ready_to_efile:
  Below is your ${comma_and_list(al_court_bundle.get_titles())} ${ noun_plural('form', al_court_bundle.get_titles()) } 
  that we will deliver to the ${trial_court} circuit clerk.

  We will deliver it securely. Please allow up to 15 minutes for the filing to
  arrive. We will email you a confirmation that it was delivered and additional
  information about what's next.
  
  Click **Back** if you need to make any changes.
  Click **Send to court** to deliver it.
  
  Here is what the ${trial_court} circuit clerk will get:
  % else:

  We ran into some technical problems and there was a problem delivering this to the ${trial_court} clerk.
  You can download the form below to print and submit.

  % endif

  ${ al_court_bundle.as_pdf() }

  % if ready_to_efile:
  Your forms are not e-filed until you press **Send to court** below.
  % endif
continue button field: efile_user_reviewed
continue button label: ":file-export: Send to court"
---
code: |
  def yes_no_confidential(opts):
    new_opts = []
    for opt in opts:
      if opt[0] == "5766":
        new_opts.append([opt[0], "No"])
      elif opt[0] == "5767":
        new_opts.append([opt[0], "Yes"])
      else:
        new_opts.append([opt[0], f"Something else ({opt[1]})"])
    return new_opts 
---
generic object: DAObject
id: motion_type
question: |
  Motion Type
fields:
  - Motion Type: x.motion_type_code
    datatype: dropdown
    code: |
      x.motion_type_options
---
generic object: ALDocument
id: Parties resp for payment
question: |
  Parties responsible for payment
fields: 
  - Parties for payment: x.existing_parties_payment_dict
    datatype: checkboxes
    code: |
      all_case_parties
---
id: are-you-using-fee-waiver
question: |
  Are you paying for the Appearance filing with a Fee waiver?
subquestion: |
  If you are paying for this appearance with a fee waiver, you can fill out and
  electronically file (e-file) both forms at the same time in this program.
  This means you donâ€™t have to print out the forms. The court will communicate
  with you by email. You will have to provide your email to e-file your appearance and fee waiver.
fields:
  - Do you want to file a fee waiver?: user_wants_efile
    datatype: yesnoradio
---
id: eFile Login
question: |
  Log in to your e-filing account
subquestion: |
  To e-file with this program, you must have an e-filing account. Log in below or 
  <a href="${ interview_url(i=logged_out_interview, reset=1, jurisdiction_id=jurisdiction_id) }" target="_blank">create a new account</a>.

  % if hasattr(user_info(), 'email'):
  This might **not** be the same login information for ${ get_config('external hostname') } (that you are currently logged into).
  % endif
fields:
  - Username or email: my_username
  - Password: my_password
    datatype: password
    hide if: user_forgot_password
  - I forgot my password: user_forgot_password
    datatype: yesno
---
############ Case Search ########
code: |
  def filter_fn(new_case):
    """Used inside case_search.yml to not include criminal cases"""
    return new_case.category not in ['76963', '76962', '76964', '76965']
---
generic object: EFCaseSearch
template: x.case_choice_label
content: |
  Which case do you want to file into?
---
generic object: EFCaseSearch
id: no cases found
question: |
  You are not able to e-file this Appearance
subquestion: |
  We could not find the case you wanted to file into. The case might still exist, but
  % if x.cms_connection_issue:
  the court's electronic system isn't online.
  % elif not x.found_cases.resp_ok:
  something is wrong with the court's electronic system.
  % else:
  it hasn't been entered into the court's sytem electronically.
  % endif

  You will have to print out and file your paper forms.
continue button field: x.warn_no_results
---
# Won't do non-inedexed filings, so forcing it out
generic object: EFCaseSearch
id: case-lookup-appearance
question: |
  Find your case
subquestion: |
  % if x.can_file_non_indexed_case:
  ${ collapse_template(explain_case_search_choices_template) }
  % endif
fields:
  - How do you want to find your case?: x.do_what_choice
    datatype: radio
    code: |
      x.get_lookup_choices(False)
---
generic object: EFCaseSearch
code: | 
  x.non_indexed_docket_number = None
---
id: not-in-case-kickout
event: not_in_case_kickout
question: |
  You might have the wrong case
subquestion: |
  You said that you weren't ${ comma_and_list(target_case.maybe_user_partips, and_string='or') }. You need to already be a part
  of the case to file an Appearance.

  Press the **Back** button to go back and select a different case or chose the opposing side.
---
need:
  - users
  - is_user_party
  - is_other_party
  - other_parties
  - target_case.found_case
only sets: add_existing_users
code: |
  if target_case.self_in_case not in ['is_self', 'is_filing']:
    not_in_case_kickout
  else:
    target_case.self_partip_choice.is_new = False
    target_case.self_partip_choice.is_form_filler = target_case.self_in_case == 'is_self'
    # Change where DA thinks this obj came from, so it says "you", and not "NAME"
    users.append(target_case.self_partip_choice.copy_deep('users[0]'))
    to_add_participants = [p for p in target_case.found_case.participants if p.instanceName != target_case.self_partip_choice.instanceName]

  for partip in to_add_participants:
    partip.is_new = False
    if is_user_party(partip):
      users.append(partip.copy_deep(f'users[{len(users.elements)}]'))
    elif is_other_party(partip):
      other_parties.append(partip.copy_deep(f'other_parties[{len(other_parties.elements)}]'))
    else:
      log(f'partip: ${partip} has weird role: ${partip.party_type}')
  add_existing_users = True